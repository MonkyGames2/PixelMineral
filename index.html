<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PixelMineral</title>

<style>
body{
  margin:0;
  background:#151515;
  color:#fff;
  font-family:monospace;
  text-align:center;
}
h1{margin:10px}
canvas{
  background:#2a2a2a;
  border:4px solid #777;
  image-rendering: pixelated;
}
button{
  margin:6px;
  padding:10px 18px;
  font-family:monospace;
  font-size:18px;
  background:#444;
  color:#fff;
  border:2px solid #999;
  cursor:pointer;
}
button:hover{background:#666}
</style>
</head>

<body>
<h1>‚õè PixelMineral</h1>

<canvas id="game" width="800" height="520"></canvas><br>

<button id="mineBtn">‚õè MINAR</button>
<button onclick="togglePickShop()">üõí PICOS</button>
<button onclick="toggleEnchantShop()">‚ú® ENCANTAMIENTOS</button>

<script>
/* ===================== SETUP ===================== */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
ctx.font="18px monospace";

const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function beep(freq,dur=0.06){
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.type="square";
  o.frequency.value=freq;
  o.connect(g);
  g.connect(audioCtx.destination);
  g.gain.value=0.05;
  o.start();
  o.stop(audioCtx.currentTime+dur);
}
function buySound(){beep(750,0.1)}
function mineSound(){beep(420,0.03)}
function breakSound(){beep(130,0.12)}

/* ===================== DATOS ===================== */
let plata=0;

const minerals=[
 {n:"Tierra",v:1,w:100,c:"#8b5a2b",hp:60},
 {n:"Piedra",v:2,w:90,c:"#777",hp:120},
 {n:"Carb√≥n",v:5,w:80,c:"#111",hp:180},
 {n:"Hierro",v:10,w:60,c:"#aaa",hp:260},
 {n:"Oro",v:20,w:30,c:"#ffd700",hp:360},
 {n:"Diamante",v:60,w:6,c:"#00ffff",hp:600}
];

const picks=[
 {n:"Pico de Madera",cost:0,base:50,dmg:5},
 {n:"Pico de Piedra",cost:50,base:150,dmg:8},
 {n:"Pico de Hierro",cost:300,base:400,dmg:18},
 {n:"Pico de Diamante",cost:900,base:1200,dmg:40}
];

let pick={
 ...picks[0],
 dur:picks[0].base,
 ench:{ef:0,for:0}
};

/* ===================== BLOQUE ===================== */
function randomBlock(){
 let total=minerals.reduce((a,b)=>a+b.w,0);
 let r=Math.random()*total;
 for(let m of minerals){
  if(r<m.w) return {...m};
  r-=m.w;
 }
 return {...minerals[0]};
}

let block=randomBlock();
let blockHP=block.hp;

/* ===================== GUARDADO ===================== */
function save(){
 localStorage.setItem("pixelSave",JSON.stringify({
  plata,
  pick
 }));
}

function load(){
 const s=localStorage.getItem("pixelSave");
 if(!s) return;
 const d=JSON.parse(s);
 plata=d.plata;
 pick=d.pick;
}
load();

/* ===================== MINAR ===================== */
function mine(){
 if(pick.dur<=0) return;
 mineSound();
 pick.dur--;
 blockHP-=pick.dmg*(1+pick.ench.ef*0.5);
 if(blockHP<=0) breakBlock();
 save();
}

function breakBlock(){
 breakSound();
 plata+=Math.floor(block.v*(1+pick.ench.for));
 block=randomBlock();
 blockHP=block.hp;
}

/* ===================== CLICK HOLD ===================== */
let mining=null;
const mineBtn=document.getElementById("mineBtn");

mineBtn.onmousedown=()=>{
 if(mining) clearInterval(mining);
 mining=setInterval(mine,120);
}
mineBtn.onmouseup=()=>clearInterval(mining);
mineBtn.onmouseleave=()=>clearInterval(mining);
mineBtn.onclick=mine;

/* ===================== TIENDAS ===================== */
let showPickShop=false,showEnchantShop=false;
let hover=-1;

function togglePickShop(){
 showPickShop=!showPickShop;
 showEnchantShop=false;
}
function toggleEnchantShop(){
 showEnchantShop=!showEnchantShop;
 showPickShop=false;
}

canvas.addEventListener("mousemove",e=>{
 hover=Math.floor((e.offsetY-140)/26);
});
canvas.addEventListener("click",()=>{
 if(showPickShop && hover>=0 && hover<picks.length){
  const p=picks[hover];
  if(plata>=p.cost){
   plata-=p.cost;
   pick={...p,dur:p.base,ench:{ef:0,for:0}};
   buySound();
   save();
  }
 }
 if(showEnchantShop){
  if(hover===0 && plata>=300){plata-=300;pick.ench.ef++;buySound()}
  if(hover===1 && plata>=400){plata-=400;pick.ench.for++;buySound()}
  save();
 }
});

/* ===================== DIBUJO ===================== */
function draw(){
 ctx.clearRect(0,0,800,520);

 ctx.fillStyle=block.c;
 ctx.fillRect(330,180,140,140);

 ctx.fillStyle="#f00";
 ctx.fillRect(330,160,140,10);
 ctx.fillStyle="#0f0";
 ctx.fillRect(330,160,140*(blockHP/block.hp),10);

 ctx.fillStyle="#fff";
 ctx.fillText("Plata: "+plata,20,30);

 ctx.fillStyle=pick.dur<=0?"#f00":"#fff";
 ctx.fillText(
  pick.n+
  " | Dur: "+pick.dur+
  " | Ef: "+pick.ench.ef+
  " | For: "+pick.ench.for,
 20,60
 );

 ctx.fillStyle="#fff";
 ctx.fillText("Bloque: "+block.n,345,350);

 if(showPickShop){
  ctx.fillText("TIENDA DE PICOS",20,120);
  picks.forEach((p,i)=>{
   if(i===hover){
    ctx.fillStyle="#0055ff";
    ctx.fillRect(15,135+i*26,300,24);
   }
   ctx.fillStyle="#fff";
   ctx.fillText(p.n+" $"+p.cost,20,155+i*26);
  });
 }

 if(showEnchantShop){
  ctx.fillText("ENCANTAMIENTOS",20,120);
  const ench=[
   "Eficiencia $300",
   "Fortuna $400"
  ];
  ench.forEach((t,i)=>{
   if(i===hover){
    ctx.fillStyle="#0055ff";
    ctx.fillRect(15,135+i*26,300,24);
   }
   ctx.fillStyle="#fff";
   ctx.fillText(t,20,155+i*26);
  });
 }
}

function loop(){
 draw();
 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
